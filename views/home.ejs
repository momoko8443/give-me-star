<!DOCTYPE html>
<html>
    <head>
        <title>give me star</title>
        <link rel="stylesheet" type="text/css" href="/bower_components/pure/pure-min.css" />
        <link rel="stylesheet" type="text/css" href="/css/main.css" />
        <script src="/bower_components/ukulelejs/dist/uku.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body uku-application>
            <div class="pure-g">
                <div class="pure-u-1-3">
                    <div class="pure-g">
                        <div class="pure-u">
                            <img class="round" uku-src="homeCtrl.avatar_url" style="width:60px;margin:20px">
                        </div>
                        <div class="pure-u">
                            <h3 uku-text="homeCtrl.name"></h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pure-g">
                <div class="pure-u-1-2">
                    <table class="pure-table pure-table-horizontal">
                    <thead>
                        <tr>
                            <th>Repository</th>
                            <th>Stars</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr uku-repeat="repo in homeCtrl.repos">
                            <td uku-text="repo.name"></td>
                            <td uku-text="repo.starts"></td>
                        </tr>
                    </tbody>    
                    </table>
                </div>
            </div>

    </body>
    <script>
        var uku = new Ukulele();
        var homeCtrl = new HomeController(uku);
        uku.registerController('homeCtrl',homeCtrl);
        uku.addListener(Ukulele.INITIALIZED,function(){
            homeCtrl.userInfo();
        });
        uku.init();

        function HomeController(uku){
            var self = this;
            this.name = "";
            this.message = "";
            this.repos = [];
            //this.avatar_url = "https://avatars.githubusercontent.com/u/4987944?v=3";
            this.userInfo = function(){
                fetch('/user',{credentials: 'same-origin'}).then(function(res){
                    if (res.ok) {
                        res.json().then(function(data) {
                            self.name = 'Welcome '+data.name;
                            self.avatar_url = data.avatar_url;
                            self.repos = data.repos;
                            uku.refresh('homeCtrl');
                            console.log(data);
                        });
                    } 
                },function(err){
                    console.log("Fetch failed!", err);
                });
            }
        }
    </script>
</html>